<!DOCTYPE html>
<html>
  <head>
    <title>Alpha Break</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding-top: 100px;
      }
      #popup {
        display: none;
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -30%);
        background: #fff;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        z-index: 10;
      }
      #popup h2 {
        margin-bottom: 20px;
      }
      button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Alpha Break üßò‚Äç‚ôÄÔ∏è</h1>
    <p>Start typing or using the app...</p>

    <div id="popup">
      <h2 id="popupText">Take a break, my dear üíñ</h2>
      <button id="yesBtn" onclick="confirmBreak(true)">Yes</button>
      <button id="noBtn" onclick="confirmBreak(false)">No</button>
      <img id="rewardImage" src="" style="display:none; max-width: 300px; margin-top: 20px;" />
      <div id="mintButtons" style="display: none; margin-top: 20px;">
        <p>Would you like to mint this Alpha Lion NFT?</p>
        <button onclick="mintLion()">Yes, Mint it</button>
        <button onclick="cancelMint()">No thanks</button>
      </div>
    </div>

    <script>
      let lastActivity;
      let lastScroll;
      let speedWindow = [];
      let popupShown = false;

      function calculateTypingSpeed() {
        const now = Date.now();
        const oneMinuteAgo = now - 60000;
        const strokesLastMinute = speedWindow.filter(ts => ts > oneMinuteAgo).length;
        return strokesLastMinute;
      }

      function confirmBreak(didTakeBreak) {
        const popup = document.getElementById('popup');

        if (didTakeBreak) {
          const lionNumber = Math.floor(Math.random() * 20) + 1;
          const imagePath = `assets/lions/lion${lionNumber}.jpg`;

          const rewardImg = document.getElementById('rewardImage');
          rewardImg.src = imagePath;
          rewardImg.style.display = 'block';

          document.getElementById('mintButtons').style.display = 'block';
          document.getElementById('popupText').textContent = 'This is your Alpha Lion ü¶Å';
          document.getElementById('yesBtn').style.display = 'none';
          document.getElementById('noBtn').style.display = 'none';
        } else {
          alert('Okay, maybe later üíº');
          closePopup();
        }
      }

      function mintLion() {
        alert("Lion NFT minting coming soon! ü¶ÅüöÄ");
        closePopup();
      }

      function cancelMint() {
        alert("No worries, maybe next time! üíº");
        closePopup();
      }

      function closePopup() {
        document.getElementById('popup').style.display = 'none';
        document.getElementById('rewardImage').style.display = 'none';
        document.getElementById('mintButtons').style.display = 'none';
        document.getElementById('popupText').textContent = 'Take a break, my dear üíñ';
        document.getElementById('yesBtn').style.display = 'inline-block';
        document.getElementById('noBtn').style.display = 'inline-block';

        popupShown = false;
        lastActivity = Date.now();
        lastScroll = Date.now();
        speedWindow = [];
      }

      window.addEventListener('load', () => {
        const now = Date.now();
        lastActivity = now;
        lastScroll = now;

        document.addEventListener('mousemove', () => {
          lastActivity = Date.now();
          popupShown = false;
        });

        document.addEventListener('keydown', () => {
          lastActivity = Date.now();
          popupShown = false;
          speedWindow.push(Date.now());
        });

        document.addEventListener('scroll', () => {
          lastScroll = Date.now();
          popupShown = false;
        });

        setTimeout(() => {
          setInterval(() => {
            const now = Date.now();
            const idleTime = now - lastActivity;
            const scrollIdle = now - lastScroll;
            const typingSpeed = calculateTypingSpeed();

            if ((idleTime > 20000 && scrollIdle > 20000) || typingSpeed < 20) {
              if (!popupShown) {
                document.getElementById('popup').style.display = 'block';
                popupShown = true;

                // Bring Electron window to front
                if (typeof require !== 'undefined') {
                  const { ipcRenderer } = require('electron');
                  ipcRenderer.send('bring-to-front');
                }
              }
            }
          }, 2000);
        }, 10000);
      });
    </script>
  </body>
</html>
